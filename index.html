<!DOCTYPE html>
<html>
  <head>
    <!-- Web Receiver SDK -->
    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <!-- Cast Debug Logger -->
    <script src="//www.gstatic.com/cast/sdk/libs/devtools/debug_layer/caf_receiver_logger.js"></script>

  </head>

  <body style="background-color:gray;">
    <!-- the only player -->
    <video id="videoPlayer"></video>

    <script>
      function initPlayer(){
        // get player reference
        var videoPlayer = document.getElementById('videoPlayer');
        // hide built in controller
        videoPlayer.controls = false;
        //videoPlayer.src = "https://storage.googleapis.com/cpe-sample-media/content/big_buck_bunny/prog/big_buck_bunny_prog.mp4";
       // videoPlayer.load();
       // videoPlayer.play();
        console.log("play video");

        var castReceiverContext = cast.framework.CastReceiverContext.getInstance();
        // Add an event listener to the defined namespace channel
        castReceiverContext.addCustomMessageListener('urn:x-cast:custom_namespace', event => {
          videoPlayer.load();
          videoPlayer.play();
          //
          console.log("from server");
          
          castDebugLogger.debug(LOG_TAG1, event.data);
          castDebugLogger.debug(LOG_TAG1, event.data.msg);

          const fromServer = JSON.parse(event.data.msg); 
          switch(fromServer.subject){
            case "play":
              // Set player's source
              videoPlayer.src = message.video_source;
              // Resets the media to the beginning and selects the best available source
              videoPlayer.load();
              // Begins playback of the media
              videoPlayer.play();
              break;
            default:
          }
        });

        // Create the CastDebugLogger object and enable the logger
        const castDebugLogger = cast.debug.CastDebugLogger.getInstance();
        castReceiverContext.addEventListener(cast.framework.system.EventType.READY, () => {
          if (!castDebugLogger.debugOverlayElement_) {
              // Enable debug logger and show a 'DEBUG MODE' overlay at top left corner.
              castDebugLogger.setEnabled(true);
          }
        });
        const LOG_TAG1 = 'Tag1';
        const LOG_TAG2 = 'Tag2';

        // Set verbosity level for custom tags
        castDebugLogger.loggerLevelByEvents = {
          'cast.framework.events.category.CORE': cast.framework.LoggerLevel.INFO,
          'cast.framework.events.EventType.MEDIA_STATUS': cast.framework.LoggerLevel.DEBUG
        }
        castDebugLogger.loggerLevelByTags = {
            [LOG_TAG1]: cast.framework.LoggerLevel.WARNING,
            [LOG_TAG2]: cast.framework.LoggerLevel.DEBUG,
        };
        castReceiverContext.addEventListener(cast.framework.system.EventType.READY, () => {
          if (!castDebugLogger.debugOverlayElement_) {
              // Enable debug logger and show a 'DEBUG MODE' overlay at top left corner.
              castDebugLogger.setEnabled(true);
              // Show debug overlay
              castDebugLogger.showDebugLogs(true);
              // Clear log messages on debug overlay
              castDebugLogger.clearDebugLogs();
          }
        });

        //
        castDebugLogger.debug(LOG_TAG1, 'debug log from tag1');
        castDebugLogger.info(LOG_TAG1, 'info log from tag1');
        castDebugLogger.warn(LOG_TAG1, 'warn log from tag1');
        castDebugLogger.error(LOG_TAG1, 'error log from tag1');

        castDebugLogger.debug(LOG_TAG2, 'debug log from tag2');
        castDebugLogger.info(LOG_TAG2, 'info log from tag2');
        castDebugLogger.warn(LOG_TAG2, 'warn log from tag2');
        castDebugLogger.error(LOG_TAG2, 'error log from tag2');






        //
        var options = new cast.framework.CastReceiverOptions();
        options.disableIdleTimeout = true;
        // Initializes system manager and media manager, so that receiver app can receive requests from senders
        castReceiverContext.start(options);

      }
     
      window.onload = initPlayer();
    </script>
  </body>
</html>